function HashMap(){var e=[];return e.size=function(){return this.length},e.isEmpty=function(){return 0===this.length},e.containsKey=function(e){e+="";for(var t=0;t<this.length;t++)if(this[t].key===e)return t;return-1},e.get=function(e){e+="";var t=this.containsKey(e);return t>-1?this[t].value:void 0},e.put=function(e,t){return e+="",-1!==this.containsKey(e)?this.get(e):void this.push({key:e,value:t})},e.allKeys=function(){for(var e=[],t=0;t<this.length;t++)e.push(this[t].key);return e},e.allIntKeys=function(){for(var e=[],t=0;t<this.length;t++)e.push(parseInt(this[t].key));return e},e.remove=function(e){e+="";var t=this.containsKey(e);t>-1&&this.splice(t,1)},e}var SERVICE_TYPE_DEFAULT=0,SERVICE_TYPE_PING=1,SERVICE_TYPE_LOGIN=2,SERVICE_TYPE_LOGOUT=3,SERVICE_TYPE_MESSAGE=4,SERVICE_TYPE_HAVE_MESSAGE=5,SERVICE_TYPE_MAKE_CONFERENCE=6,SERVICE_TYPE_MESSAGE_CONFERENCE=7,SERVICE_TYPE_HAVE_MESSAGE_CONFERENCE=8,SERVICE_TYPE_FRIEND_LIST=13,SERVICE_TYPE_FRIEND_LIST_DONE=37,SERVICE_TYPE_USER_INFO=24,SERVICE_GET_SERVER_ADDR=29,SERVICE_TYPE_MAKE_CHAT_GROUP=42,SERVICE_TYPE_LEAVE_CHAT_GROUP=43,SERVICE_TYPE_INVITE_CHAT_GROUP=44,SERVICE_TYPE_MESSAGE_CHAT_GROUP=45,SERVICE_TYPE_MESSAGE2=72,SERVICE_TYPE_HAVE_MESSAGE2=73,SERVICE_TYPE_MESSAGE_CHAT_GROUP_REPORT=74,SERVICE_TYPE_MESSAGE_STICKER=104,SERVICE_TYPE_APPLICATION_CHANGE_STATE=105,SERVICE_TYPE_MESSAGE_LOCATION=113,SERVICE_TYPE_MESSAGE_FILE_URL=121,SERVICE_TYPE_CANCEL_MESSAGE=127,SERVICE_TYPE_CHAT_TYPING=142,SERVICE_TYPE_MAKE_CHAT_GROUP_NOTIFICATION=143,SERVICE_TYPE_INVITE_CHAT_GROUP_NOTIFICATION=144,SERVICE_TYPE_LEAVE_CHAT_GROUP_NOTIFICATION=145,SERVICE_TYPE_HAVE_MESSAGE_CHAT_GROUP=146,SERVICE_TYPE_LIST_CHAT_GROUP=147,SERVICE_TYPE_CHAT_GROUP_INFO=148,SERVICE_TYPE_CHAT_GROUP_TYPING=149,SERVICE_TYPE_CHAT_GROUP_RENAME=150,SERVICE_TYPE_CHAT_GROUP_CANCEL_MESSAGE=151,SERVICE_TYPE_CHAT_GROUP_RENAME_NOTIFICATION=152,SERVICE_TYPE_MSG_SEEN=153,SERVICE_TYPE_CHAT_GROUP_NOTIFICATION_SETTINGS=158,SERVICE_TYPE_CHAT_GROUP_CHANGE_ADMIN=159,SERVICE_TYPE_AUTHENTICATION=162,SERVICE_TYPE_LIST_USERINFO_BY_USERID=164,SERVICE_TYPE_LIST_USERINFO_BY_USERNAME=165,SERVICE_TYPE_MESSAGE_REPORT2=167,SERVICE_TYPE_DELETE_MESSAGE=168,SERVICE_TYPE_LIST_MODIFIED_MESSAGES=169,SERVICE_TYPE_LIST_MODIFIED_CONVERSATIONS=170,SERVICE_TYPE_LIST_DELETE_CONVERSATION=171,SERVICE_TYPE_DELIVERED_MESSAGES=172,SERVICE_TYPE_LIST_UNREAD_MESSAGES=173,SERVICE_TYPE_MESSAGE_FROM_ME=174,SERVICE_TYPE_MESSAGE_FROM_ME_JSON=175,SERVICE_TYPE_MESSAGE_GROUP_FROM_ME=176,SERVICE_TYPE_SEEN_MESSAGES=178,SERVICE_TYPE_AUTHENTICATION_2_STEP=179,SERVICE_TYPE_LIST_CHAT_GROUPS_INFO=182,SERVICE_TYPE_LIST_MODIFIED_FILES=191,SERVICE_TYPE_CHAT_BROADCAST_CREATE_LIST=192,SERVICE_TYPE_CHAT_BROADCAST_EDIT_LIST=193,SERVICE_TYPE_CHAT_BROADCAST_GET_LIST=194,SERVICE_TYPE_MESSAGE_BROADCAST=154,SERVICE_TYPE_HAVE_MESSAGE_BROADCAST=155,SERVICE_TYPE_CHAT_BROADCAST_DELETE_LIST=195,SERVICE_TYPE_CHAT_BROADCAST_GET_MESSAGES=196,SERVICE_TYPE_CHAT_GROUP_JOIN_PUBLIC=197,SERVICE_TYPE_CHAT_GROUP_GET_LIST_PUBLIC=198,SERVICE_TYPE_LIST_CHAT_GROUPS_INFO_MORE=200,SERVICE_TYPE_CHAT_BROADCAST_INFO=201,SERVICE_TYPE_WEBRTC_CALL_INVITE=186,SERVICE_TYPE_WEBRTC_CALL_DATA=187,SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE=188,SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE_BY_ME=199,SERVICE_TYPE_CHARGING_GET_BALANCE=185,azstack={packet_queue:new HashMap,send_packet_queue:new HashMap,users:new HashMap,azStackUsers:new HashMap,masterSocket:null,slaveSocket:null,groups:new HashMap,getListUserInfoByUserIdRequestId:1e3,waitingPacketByListUserId:new HashMap,callbacks:new HashMap,ignoreCallBack:[],callbackTimeoutTime:6e4,appId:null,publicKey:null,azStackUserId:null,userCredentials:null,fullname:null,slaveServerIp:null,slaveServerPort:0,logLevel:"ERROR",callbackId:0,chatProxyServer:"https://www.azhub.xyz:9199",sdkVersion:"2.2.4",reConnecting:!1};azstack.getCookie=function(e){for(var t=e+"=",s=document.cookie.split(";"),a=0;a<s.length;a++){for(var i=s[a];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""},azstack.setCookie=function(e,t,s){var a=new Date;a.setTime(a.getTime()+24*s*60*60*1e3);var i="expires="+a.toUTCString();document.cookie=e+"="+t+"; "+i},azstack.log=function(e,t){var s=2;"ERROR"==e?s=3:"INFO"==e?s=2:"DEBUG"==e&&(s=1);var a=2;"ERROR"==this.logLevel?a=3:"INFO"==this.logLevel?a=2:"DEBUG"==this.logLevel&&(a=1),s>=a&&(null!=t&&"object"==typeof t||Array.isArray(t)?console.log(e+": "+JSON.stringify(t)):console.log(e+": "+t))},azstack.addCallback=function(e,t){this.callbacks.put(e,t)},azstack.callCallback=function(e){var t=this.callbacks.get(e);if(t){var s=new Array;for(var a in arguments)0!=a&&(s[s.length]=arguments[a]);t.apply(this,s),this.callbacks.remove(e)}},azstack.addTimeout=function(e,t,s,a){azstack.addCallback("timeout_"+e,t),setTimeout(function(){if(-1==azstack.ignoreCallBack.indexOf("timeout_"+e))azstack.callCallback("timeout_"+e,s);else for(var t=0;t<azstack.ignoreCallBack.length;t++)if(azstack.ignoreCallBack[t]=="timeout_"+e){azstack.ignoreCallBack.splice(t,1);break}},a)},azstack.clearTimeout=function(e){azstack.ignoreCallBack.push("timeout_"+e)},azstack.sendPacketMaster=function(e,t){var s={service:e,body:JSON.stringify(t)};this.masterSocket.emit("WebPacket",s)},azstack.sendPacket=function(e,t){var s={service:e,body:JSON.stringify(t)};this.slaveSocket.emit("WebPacket",s)},azstack.connect=function(e,t,s,a,i,o){this.masterSocket=io.connect(this.chatProxyServer,{resource:"A/socket.io","force new connection":!0}),this.masterSocket.on("connect",function(){azstack.log("DEBUG","Client has connected to the MasterServer!"),azstack.sendPacketMaster(SERVICE_GET_SERVER_ADDR,{azStackUserId:s})}),this.masterSocket.on("WebPacket",function(e){var t;t=e.body.length>0?JSON.parse(e.body):{},azstack.packetReceived(e.service,t)}),this.masterSocket.on("disconnect",function(){azstack.log("DEBUG","The client has disconnected with MasterServer!")}),this.appId=e,this.publicKey=t,this.azStackUserId=s,this.userCredentials=a,this.fullname=i,this.namespace=o},azstack.packetReceived=function(e,t){e==SERVICE_GET_SERVER_ADDR?this.get_server_addr_processor(e,t):e==SERVICE_TYPE_AUTHENTICATION?this.authentication_processor(e,t):e==SERVICE_TYPE_PING?this.ping_processor(e,t):e==SERVICE_TYPE_HAVE_MESSAGE2?this.have_message_processor(e,t):e==SERVICE_TYPE_CHAT_TYPING?this.chat_typing_processor(e,t):e==SERVICE_TYPE_CHAT_GROUP_TYPING?this.chat_group_typing_processor(e,t):e==SERVICE_TYPE_USER_INFO?this.user_info_processor(e,t):e==SERVICE_TYPE_LIST_USERINFO_BY_USERNAME?this.user_info_by_username_processor(e,t):e==SERVICE_TYPE_LIST_USERINFO_BY_USERID?this.getListUserInfoByListUserIDsProcessor(e,t):e==SERVICE_TYPE_MESSAGE_FILE_URL?this.have_message_file_url_processor(e,t):e==SERVICE_TYPE_MESSAGE_LOCATION?this.have_message_location_processor(e,t):e==SERVICE_TYPE_LIST_MODIFIED_CONVERSATIONS?this.get_list_modified_conversations_processor(e,t):e==SERVICE_TYPE_LIST_MODIFIED_MESSAGES?this.get_list_modified_messages_processor(e,t):e==SERVICE_TYPE_LIST_UNREAD_MESSAGES?this.get_list_unread_messages_processor(e,t):e==SERVICE_TYPE_MESSAGE2?this.messageProcessor(e,t):e==SERVICE_TYPE_MESSAGE_REPORT2?this.messageReportProcessor(e,t):e==SERVICE_TYPE_DELIVERED_MESSAGES?this.deliveredMessagesProcessor(e,t):e==SERVICE_TYPE_LIST_CHAT_GROUPS_INFO?this.getListGroupInfoProcessor(e,t):e==SERVICE_TYPE_LIST_CHAT_GROUPS_INFO_MORE?this.getListGroupInfoMoreProcessor(e,t):e==SERVICE_TYPE_MESSAGE_CHAT_GROUP?this.messageGroupProcessor(e,t):e==SERVICE_TYPE_MESSAGE_CHAT_GROUP_REPORT?this.messageReportGroupProcessor(e,t):e==SERVICE_TYPE_HAVE_MESSAGE_CHAT_GROUP?this.haveMessageGroupProcessor(e,t):e==SERVICE_TYPE_MESSAGE_FROM_ME?this.haveMsgFromMeProcessor(e,t):e==SERVICE_TYPE_MESSAGE_FROM_ME_JSON?this.haveMsgFromMeProcessor(e,t):e==SERVICE_TYPE_MESSAGE_GROUP_FROM_ME?this.haveMsgGroupFromMeProcessor(e,t):e==SERVICE_TYPE_MAKE_CHAT_GROUP?this.makeGroupProcessor(e,t):e==SERVICE_TYPE_INVITE_CHAT_GROUP?this.inviteToGroupProcessor(e,t):e==SERVICE_TYPE_LEAVE_CHAT_GROUP?this.leaveGroupProcessor(e,t):e==SERVICE_TYPE_CHAT_GROUP_RENAME?this.renameGroupProcessor(e,t):e==SERVICE_TYPE_APPLICATION_CHANGE_STATE?this.applicationChangeStateProcessor(e,t):e==SERVICE_TYPE_CHARGING_GET_BALANCE?this.chargingGetBalanceProcessor(e,t):e==SERVICE_TYPE_CANCEL_MESSAGE?this.cancelMessageProcessor(e,t):e==SERVICE_TYPE_CHAT_GROUP_CANCEL_MESSAGE?this.groupCancelMessageProcessor(e,t):e==SERVICE_TYPE_MAKE_CHAT_GROUP_NOTIFICATION?this.makeGroupNotificationProcessor(e,t):e==SERVICE_TYPE_INVITE_CHAT_GROUP_NOTIFICATION?this.inviteToGroupNotificationProcessor(e,t):e==SERVICE_TYPE_LEAVE_CHAT_GROUP_NOTIFICATION?this.leaveGroupNotificationProcessor(e,t):e==SERVICE_TYPE_CHAT_GROUP_RENAME_NOTIFICATION?this.renameGroupNotificationProcessor(e,t):e==SERVICE_TYPE_CHAT_GROUP_INFO?this.getGroupInfoProcessor(e,t):e==SERVICE_TYPE_LIST_DELETE_CONVERSATION?this.deleteConversationProcessor(e,t):e==SERVICE_TYPE_MSG_SEEN?this.seenMessageProcessor(e,t):e==SERVICE_TYPE_SEEN_MESSAGES?this.seenMessageProcessor(e,t):e==SERVICE_TYPE_DELETE_MESSAGE?this.deleteMessageProcessor(e,t):e==SERVICE_TYPE_LIST_CHAT_GROUP?this.listChatGroupProcessor(e,t):e==SERVICE_TYPE_CHAT_GROUP_CHANGE_ADMIN?this.chatGroupChangeAdminProcessor(e,t):e==SERVICE_TYPE_LIST_MODIFIED_FILES?this.chatListFilesProcessor(e,t):e==SERVICE_TYPE_CHAT_BROADCAST_CREATE_LIST?this.chatBroadCastCreateListProcessor(e,t):e==SERVICE_TYPE_CHAT_BROADCAST_EDIT_LIST?this.chatBroadCastEditListProcessor(e,t):e==SERVICE_TYPE_CHAT_BROADCAST_GET_LIST?this.chatBroadCastGetListProcessor(e,t):e==SERVICE_TYPE_CHAT_BROADCAST_INFO?this.getBroadcastInfoProcessor(e,t):e==SERVICE_TYPE_MESSAGE_BROADCAST?this.messageBroadCastProcessor(e,t):e==SERVICE_TYPE_HAVE_MESSAGE_BROADCAST?this.haveMessageBroadCastProcessor(e,t):e==SERVICE_TYPE_CHAT_BROADCAST_DELETE_LIST?this.chatBroadCastDeleteListProcessor(e,t):e==SERVICE_TYPE_CHAT_BROADCAST_GET_MESSAGES?this.chatBroadCastGetMessagesProcessor(e,t):e==SERVICE_TYPE_CHAT_GROUP_JOIN_PUBLIC?this.chatGroupJoinPublicProcessor(e,t):e==SERVICE_TYPE_CHAT_GROUP_GET_LIST_PUBLIC?this.chatGroupGetListPublicProcessor(e,t):e==SERVICE_TYPE_MESSAGE_STICKER?this.haveMessageStickerProcessor(e,t):e==SERVICE_TYPE_WEBRTC_CALL_INVITE?this.inviteVideoCallProcessor(e,t):e==SERVICE_TYPE_WEBRTC_CALL_DATA?this.dataVideoCallProcessor(e,t):e==SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE?this.statusVideoCallProcessor(e,t):e==SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE_BY_ME?this.statusVideoCallByMeProcessor(e,t):(azstack.log("DEBUG","unknow packet"),azstack.log("DEBUG","service: "+e),azstack.log("DEBUG",t))},azstack.azSendMessageReport=function(e,t){var s={to:e,msgId:t};this.sendPacket(SERVICE_TYPE_MESSAGE_REPORT2,s)},azstack.azSendMessageGroupReport=function(e,t,s){var a={group:e,msgId:t,msgSender:s};this.sendPacket(SERVICE_TYPE_MESSAGE_CHAT_GROUP_REPORT,a)},azstack.cacheUserInfo=function(e){var t={userId:e.userId,azStackUserID:e.username,lastVisitDate:e.lastVisitDate,status:e.status,fullname:e.fullname};this.users.remove(e.userId),this.azStackUsers.remove(e.username),this.users.put(e.userId,t),this.azStackUsers.put(e.username,t)},azstack.cacheGroupInfo=function(e){var t={numberOfMembers:e.members.length,name:e.name,id:e.group,avatar:e.groupAvatar,members:e.members,admin:e.admin,type:e.type};this.groups.remove(t.id),this.groups.put(t.id,t)},azstack.addMemberGroupInfo=function(e){this.groups.get(e.group).members.push.apply(this.groups.get(e.group).members,e.members),this.groups.get(e.group).numberOfMembers=this.groups.get(e.group).members.length},azstack.getUserInfoAndRequestToServer=function(e,t){var s=this.users.get(e);if(!s){var a=this.packet_queue.get(e);return a||(a=[],this.packet_queue.put(e,a),this.sendPacket(SERVICE_TYPE_USER_INFO,{userId:e})),void a.push(t)}return s},azstack.getUserInfoAndRequestToServerWithCallBack=function(e,t,s){var a=this.users.get(e);if(this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,t,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,t),!a){var i=this.packet_queue.get(e);return i||(i=[],this.packet_queue.put(e,i),this.sendPacket(SERVICE_TYPE_USER_INFO,{userId:e,purpose:this.callbackId})),void i.push(s)}return this.clearTimeout("get_user_server_"+this.callbackId),this.callCallback("get_user_server_"+this.callbackId,[a]),a},azstack.getUserInfoByUsernameAndRequestToServerWithCallBack=function(e,t,s){var a=this.azStackUsers.get(e);if(this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,t,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,t),!a){azstack.log("DEBUG","Gui yeu cau get user_info len server de lay thong tin azStackUserID="+e);var i=this.send_packet_queue.get(e);return i||(i=[],this.send_packet_queue.put(e,i),this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:[e],purpose:this.callbackId})),void i.push(s)}return this.clearTimeout("get_user_server_"+this.callbackId),this.callCallback("get_user_server_"+this.callbackId,[a]),a},azstack.getUserInfoByUsernameAndRequestToServer=function(e,t){var s=this.azStackUsers.get(e);if(!s){azstack.log("DEBUG","Gui yeu cau get user_info len server de lay thong tin azStackUserID="+e);var a=this.send_packet_queue.get(e);return a||(a=[],this.send_packet_queue.put(e,a),this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:[e]})),void a.push(t)}return s},azstack.azSendMessage=function(e,t,s,a){var i={msg:e,to:0,msgId:s},o={service:SERVICE_TYPE_MESSAGE2,body:i},c=this.getUserInfoByUsernameAndRequestToServer(t,o);c&&(i.to=c.userId,this.sendPacket(SERVICE_TYPE_MESSAGE2,i),this.addTimeout("send_message_"+s,a,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_"+s,a))},azstack.azSendMessageFileUrl=function(e,t,s,a,i,o,c,r,n,d){var l={duration:n,to:0,id:i,fileLength:o,fileName:t,type:s,url:e,width:c,height:r},u={service:SERVICE_TYPE_MESSAGE_FILE_URL,body:l},_=this.getUserInfoByUsernameAndRequestToServer(a,u);_&&(l.to=_.userId,this.sendPacket(SERVICE_TYPE_MESSAGE_FILE_URL,l),this.addTimeout("send_message_"+i,d,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_"+i,d))},azstack.azSendMessageLocation=function(e,t,s,a,i,o){var c={id:i,"long":e,lat:t,addr:s,type:4},r={service:SERVICE_TYPE_MESSAGE_LOCATION,body:c},n=this.getUserInfoByUsernameAndRequestToServer(a,r);n&&(c.to=n.userId,this.sendPacket(SERVICE_TYPE_MESSAGE_LOCATION,c),this.addTimeout("send_message_"+i,o,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_"+i,o))},azstack.azSendMessageLocationGroup=function(e,t,s,a,i,o,c){var r={group:e,groupName:t,msgId:o,type:4,"long":s,lat:a,addr:i};this.sendPacket(SERVICE_TYPE_MESSAGE_CHAT_GROUP,r),this.addTimeout("send_message_group_"+o,c,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_group_"+o,c)},azstack.azSendMessageGroup=function(e,t,s,a){var i={msg:e,group:t,msgId:s};this.sendPacket(SERVICE_TYPE_MESSAGE_CHAT_GROUP,i),this.addTimeout("send_message_group_"+s,a,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_group_"+s,a)},azstack.azSendMessageSticker=function(e,t,s,a,i,o,c,r){var n={imgName:t,catId:s,topText:"",bottomText:"",middleText:"",id:a,to:0,url:i,width:o,height:c},d={service:SERVICE_TYPE_MESSAGE_STICKER,body:n},l=this.getUserInfoByUsernameAndRequestToServer(e,d);l&&(n.to=l.userId,this.sendPacket(SERVICE_TYPE_MESSAGE_STICKER,n),this.addTimeout("send_message_"+a,r,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_"+a,r))},azstack.azSendMessageStickerGroup=function(e,t,s,a,i,o,c,r){var n={type:3,msgId:a,group:e,catId:s,url:i,imgName:t,width:o,height:c};this.sendPacket(SERVICE_TYPE_MESSAGE_CHAT_GROUP,n),this.addTimeout("send_message_group_"+a,r,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_group_"+a,r)},azstack.azSendMessageFileUrlGroup=function(e,t,s,a,i,o,c,r,n,d){var l={duration:n,fileLength:o,fileName:i,group:e,msgId:t,url:s,type:a,width:c,height:r};this.sendPacket(SERVICE_TYPE_MESSAGE_CHAT_GROUP,l),this.addTimeout("send_message_group_"+t,d,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_group_"+t,d)},azstack.azGetListModifiedConversations=function(e){var t={lastUpdate:e};this.sendPacket(SERVICE_TYPE_LIST_MODIFIED_CONVERSATIONS,t)},azstack.azGetListModifiedConversationsPage=function(e,t,s){var a={page:e,lastCreated:t};s&&(this.callbackId++,a.requestId=this.callbackId,this.addTimeout("getListModifiedConversationsPage_"+a.requestId,s,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("getListModifiedConversationsPage_"+a.requestId,s)),this.sendPacket(SERVICE_TYPE_LIST_MODIFIED_CONVERSATIONS,a)},azstack.azGetListModifiedMessages=function(e,t,s){var a={lastUpdate:e,type:t,chatId:s};this.sendPacket(SERVICE_TYPE_LIST_MODIFIED_MESSAGES,a)},azstack.azGetListModifiedMessagesPage=function(e,t,s,a,i){var o={page:e,type:s,chatId:a,lastCreated:t};i&&(this.callbackId++,o.requestId=this.callbackId,this.addTimeout("getListModifiedMessagesPage_"+o.requestId,i,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("getListModifiedMessagesPage_"+o.requestId,i)),this.sendPacket(SERVICE_TYPE_LIST_MODIFIED_MESSAGES,o)},azstack.azGetListUnreadMessages=function(e,t){var s={type:e,chatId:t};this.sendPacket(SERVICE_TYPE_LIST_UNREAD_MESSAGES,s)},azstack.azGetListUnreadMessagesPage=function(e,t,s,a){var i={page:e,type:t,chatId:s};a&&(this.callbackId++,i.requestId=this.callbackId,this.addTimeout("getListUnreadMessagesPage_"+i.requestId,a,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("getListUnreadMessagesPage_"+i.requestId,a)),this.sendPacket(SERVICE_TYPE_LIST_UNREAD_MESSAGES,i)},azstack.azSendTyping=function(e,t){if(1==e){var s={to:t};this.sendPacket(SERVICE_TYPE_CHAT_TYPING,s)}else if(2==e){var s={group:t};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_TYPING,s)}},azstack.requestUserInfoForPacket=function(e,t,s){this.getListUserInfoByUserIdRequestId++,this.waitingPacketByListUserId.put(this.getListUserInfoByUserIdRequestId,{service:t,body:s}),this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERID,{userIdList:e.allIntKeys(),purpose:this.getListUserInfoByUserIdRequestId})},azstack.requestGroupInfoForPacket=function(e,t,s){this.getListUserInfoByUserIdRequestId++,this.waitingPacketByListUserId.put(this.getListUserInfoByUserIdRequestId,{service:t,body:s}),this.sendPacket(SERVICE_TYPE_LIST_CHAT_GROUPS_INFO,{list:e.allIntKeys(),purpose:this.getListUserInfoByUserIdRequestId})},azstack.azMakeGroup=function(e,t,s,a,i){var o={members:e,name:t,msgId:s,type:a};this.sendPacket(SERVICE_TYPE_MAKE_CHAT_GROUP,o),this.addTimeout("makeGroup_"+s,i,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("makeGroup_"+s,i)},azstack.azInviteToGroup=function(e,t,s,a){var i={members:e,group:t,msgId:s};this.sendPacket(SERVICE_TYPE_INVITE_CHAT_GROUP,i),this.addTimeout("inviteToGroup_"+s,a,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("inviteToGroup_"+s,a)},azstack.azLeaveGroup=function(e,t,s,a){var i={leaveUser:e,group:t,msgId:s};this.sendPacket(SERVICE_TYPE_LEAVE_CHAT_GROUP,i),this.addTimeout("leaveGroup_"+s,a,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("leaveGroup_"+s,a)},azstack.azRenameGroup=function(e,t,s,a){var i={name:e,group:t,msgId:s};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_RENAME,i),this.addTimeout("renameGroup_"+s,a,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("renameGroup_"+s,a)},azstack.azGetGroupInfo=function(e,t){var s=this.groups.get(e),a={group:e};return this.sendPacket(SERVICE_TYPE_CHAT_GROUP_INFO,a),this.addTimeout("getGroupInfo_"+e,t,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("getGroupInfo_"+e,t),s},azstack.azDeleteConversation=function(e,t,s,a){var i={chatId:e,type:t,lastTimeCreated:s};this.sendPacket(SERVICE_TYPE_LIST_DELETE_CONVERSATION,i),this.addTimeout("deleteConversation_"+e+"_"+t+"_"+s,a,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("deleteConversation_"+e+"_"+t+"_"+s,a)},azstack.azSeenMessage=function(e,t,s,a){var i={msgId:e,senderId:t,type:s,chatId:a};this.sendPacket(SERVICE_TYPE_MSG_SEEN,i)},azstack.azSeenMessages=function(e,t,s,a){var i={chatId:e,type:t,lastMsgCreated:s,list:a};this.sendPacket(SERVICE_TYPE_SEEN_MESSAGES,i)},azstack.disconnect=function(){this.appId=null,this.publicKey=null,this.azStackUserId=null,this.userCredentials=null,this.fullname=null,this.masterSocket&&this.masterSocket.disconnect instanceof Function&&this.masterSocket.disconnect(),this.slaveSocket&&this.slaveSocket.disconnect instanceof Function&&this.slaveSocket.disconnect(),this.packet_queue=new HashMap,this.send_packet_queue=new HashMap,this.users=new HashMap,this.azStackUsers=new HashMap,this.masterSocket=null,this.slaveSocket=null,this.groups=new HashMap,this.waitingPacketByListUserId=new HashMap,this.callbacks=new HashMap,this.slaveServerIp=null,this.slaveServerPort=0},azstack.azDeleteMessage=function(e,t,s,a,i){var o={msgId:e,senderId:t,chatId:s,type:a};this.sendPacket(SERVICE_TYPE_DELETE_MESSAGE,o),this.addTimeout("deleteMessage_"+t+"_"+e,i,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("deleteMessage_"+t+"_"+e,i)},azstack.azListChatGroup=function(){var e={};this.sendPacket(SERVICE_TYPE_LIST_CHAT_GROUP,e)},azstack.azChatGroupChangeAdmin=function(e,t,s,a,i){var o={group:e,newAdmin:t,msgId:s,from:a};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_CHANGE_ADMIN,o),this.addTimeout("chatGroupChangeAdmin_"+s,i,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("chatGroupChangeAdmin_"+s,i)},azstack.azListFiles=function(e){var t={lastUpdate:e};this.sendPacket(SERVICE_TYPE_LIST_MODIFIED_FILES,t)},azstack.azApplicationChangeState=function(e){var t={state:e};this.sendPacket(SERVICE_TYPE_APPLICATION_CHANGE_STATE,t)},azstack.azChatBroadCastCreateList=function(e,t){var s={members:e,name:t};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_CREATE_LIST,s)},azstack.azChatBroadCastEditList=function(e,t,s,a,i){var o={removeUsers:e,name:t,id:s,addUsers:a,msgId:i};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_EDIT_LIST,o)},azstack.azChatBroadCastGetList=function(e){var t={lastUpdate:e};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_GET_LIST,t)},azstack.azMessageBroadCast=function(e,t,s,a){var i={broadcast:e,msg:t,msgId:s,type:0};this.sendPacket(SERVICE_TYPE_MESSAGE_BROADCAST,i),this.addTimeout("send_message_broadcast_"+s,a,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_broadcast_"+s,a)},azstack.azMessageStickerBroadCast=function(e,t,s,a,i,o,c,r){var n={broadcast:e,msgId:t,type:3,imgName:s,catId:a,url:i,width:o,height:c};this.sendPacket(SERVICE_TYPE_MESSAGE_BROADCAST,n),this.addTimeout("send_message_broadcast_"+t,r,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_broadcast_"+t,r)},azstack.azMessageFileBroadCast=function(e,t,s,a,i,o,c,r,n){var d={broadcast:e,msgId:t,type:s,url:a,fileName:i,fileLength:o,width:c,height:r};this.sendPacket(SERVICE_TYPE_MESSAGE_BROADCAST,d),this.addTimeout("send_message_broadcast_"+t,n,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("send_message_broadcast_"+t,n)},azstack.azChatBroadCastDeleteList=function(e){var t={broadcastId:e};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_DELETE_LIST,t)},azstack.azChatBroadCastGetMessages=function(e,t){var s={broadcastId:e,lastUpdate:t};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_GET_MESSAGES,s)},azstack.azChatGroupJoinPublic=function(e,t){var s={group:e,msgId:t};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_JOIN_PUBLIC,s)},azstack.azChatGroupGetListPublic=function(){var e={};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_GET_LIST_PUBLIC,e)},azstack.azWebRTC={iceServers:null,remoteVideo:[],localVideo:null,currentPeerConnection:null,hasVideo:!0,localCandidate:[],localSdp:null,remoteCandidate:[],remoteSdp:null,isCaller:null,localStream:null,remoteStream:[],unAddedRemoteSdp:!0,unAddedRemoteCandidate:[],currentCall:null,init:function(){if(RTCPeerConnection){var e={DtlsSrtpKeyAgreement:!0},t=null;this.iceServers&&(t={iceServers:this.iceServers});var s={optional:[e]};this.currentPeerConnection=new RTCPeerConnection(t,s),this.currentPeerConnection.onaddstream=function(e){if(0===!azstack.azWebRTC.remoteVideo.length)return void azstack.log("ERROR","remote video is empty");azstack.log("DEBUG","once remote stream arrives, show it in the remote video element");for(var t=!1,s=0;s<azstack.azWebRTC.remoteVideo.length;s++){var a=azstack.azWebRTC.remoteVideo[s];a.src||(t=!0,azstack.azWebRTC.remoteStream.push(e.stream),a.src=URL.createObjectURL(e.stream),a.onloadedmetadata=function(e){azstack.onVideoCallRemoteVideoLoaded(),a.play()})}t||azstack.log("ERROR","No video availble for binding")}}else azstack.log("ERROR","RTCPeerConnection is null")},bindVideo:function(e,t){this.localVideo=document.getElementById(e),this.localVideo||azstack.log("ERROR","Cannot attaching local video with id "+e);var s=document.getElementById(t);s?this.remoteVideo.push(s):azstack.log("ERROR","Cannot attaching remote video with id "+t)},start:function(e,t,s){if(this.isCaller=e,!this.currentPeerConnection)return void azstack.log("ERROR","currentPeerConnection is null");if(this.currentPeerConnection.onicecandidate=function(e){if(e.candidate){var a={sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex,sdp:e.candidate.candidate};azstack.azWebRTC.localCandidate.push(e.candidate);var i={to:t,callId:s,type:2,data:a};azstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_DATA,i),azstack.log("DEBUG","Send any ice candidates to the other peer: "+JSON.stringify(i))}},!navigator.getUserMedia)return void azstack.log("ERROR","getUserMedia is null");var a={audio:!0,video:!1};this.hasVideo&&(a.video=!0),navigator.getUserMedia(a,function(a){function i(a){if(azstack.azWebRTC.currentPeerConnection.setLocalDescription(a),azstack.azWebRTC.localSdp=a,e)i={to:t,callId:s,sdp:a,mediaType:azstack.azWebRTC.hasVideo?2:1},azstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_INVITE,i),azstack.log("DEBUG","Start the video call: "+JSON.stringify(i));else{var i={to:t,callId:s,type:1,data:a};azstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_DATA,i),azstack.log("DEBUG","Send sdp ...: "+JSON.stringify(i))}}function o(e){azstack.log("DEBUG","Offer error: "+JSON.stringify(e))}if(azstack.log("DEBUG","Got the local steam"),azstack.azWebRTC.currentPeerConnection.addStream(a),azstack.azWebRTC.localStream=a,e)azstack.azWebRTC.currentPeerConnection.createOffer(i,o);else{if(packet={to:t,callId:s,status:200},azstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,packet),azstack.log("DEBUG","Start the video answer: "+JSON.stringify(packet)),azstack.azWebRTC.currentPeerConnection?RTCSessionDescription?(azstack.log("DEBUG","set remote sdp after call started"),azstack.azWebRTC.currentPeerConnection.setRemoteDescription(new RTCSessionDescription(azstack.azWebRTC.remoteSdp)),azstack.azWebRTC.unAddedRemoteSdp=!1):azstack.log("ERROR","RTCSessionDescription is null"):azstack.log("ERROR","currentPeerConnection is null"),azstack.azWebRTC.unAddedRemoteCandidate.length>0)if(azstack.azWebRTC.currentPeerConnection)if(RTCIceCandidate){azstack.log("DEBUG","set remote candidate after call started");for(var c=0;c<azstack.azWebRTC.unAddedRemoteCandidate.length;c++)azstack.azWebRTC.currentPeerConnection.addIceCandidate(new RTCIceCandidate(azstack.azWebRTC.unAddedRemoteCandidate[c]));azstack.azWebRTC.unAddedRemoteCandidate=[]}else azstack.log("ERROR","RTCIceCandidate is null");else azstack.log("ERROR","currentPeerConnection is null");azstack.azWebRTC.currentPeerConnection.createAnswer(i,o)}return azstack.azWebRTC.localVideo?(azstack.azWebRTC.localVideo.src=URL.createObjectURL(a),void(azstack.azWebRTC.localVideo.onloadedmetadata=function(e){azstack.onVideoCallLocalVideoLoaded(),azstack.azWebRTC.localVideo.play()})):void azstack.log("ERROR","local video is null")},function(e){azstack.log("DEBUG","getUserMedia error: "+JSON.stringify(e))})},toggleVideoState:function(e){if(!this.localStream)return void azstack.log("ERROR","Can't toggle video state, localStream is null");var t=this.localStream.getVideoTracks();if(0===t.length)return void azstack.log("ERROR","Can't toggle video state, no video stream found");if("boolean"!=typeof e){for(var s=0;s<t.length;s++)t[s].enabled=!t[s].enabled;azstack.log("DEBUG","Toggle video state done, "+(t[0].enabled?"unmuted.":"muted."))}else{for(var s=0;s<t.length;s++)t[s].enabled=e;azstack.log("DEBUG","Set video state done, "+(t[0].enabled?"unmuted.":"muted."))}},toggleAudioState:function(e){if(!this.localStream)return void azstack.log("ERROR","Can't toggle audio state, localStream is null");var t=this.localStream.getAudioTracks();if(0===t.length)return void azstack.log("ERROR","Can't toggle audio state, no audio stream found");if("boolean"!=typeof e){for(var s=0;s<t.length;s++)t[s].enabled=!t[s].enabled;azstack.log("DEBUG","Toggle audio state done, "+(t[0].enabled?"unmuted.":"muted."))}else{for(var s=0;s<t.length;s++)t[s].enabled=e;azstack.log("DEBUG","Set audio state done, "+(t[0].enabled?"unmuted.":"muted."))}},clean:function(){azstack.log("DEBUG","before clean: "+JSON.stringify(this)),this.localStream&&("undefined"==typeof this.localStream.getTracks?this.localStream.stop():this.localStream.getTracks().forEach(function(e){e.stop()})),this.localVideo&&(this.localVideo.pause(),this.localVideo.src="",this.localVideo.removeAttribute("src"));for(var e=0;e<this.remoteVideo.length;e++){var t=this.remoteVideo[e];t.pause(),t.src="",t.removeAttribute("src")}this.currentPeerConnection=null,this.localVideo=null,this.remoteVideo=[],this.hasVideo=!0,this.isCaller=null,this.localSdp=null,this.localCandidate=[],this.remoteSdp=null,this.remoteCandidate=[],this.unAddedRemoteSdp=!0,this.unAddedRemoteCandidate=[],this.localStream=null,this.remoteStream=[],this.currentCall=null,azstack.log("DEBUG","after clean: "+JSON.stringify(this))}},azstack.azStartVideoCall=function(e,t,s,a,i){this.azWebRTC.currentPeerConnection||this.azWebRTC.init(),this.azWebRTC.currentCall=t,this.azWebRTC.hasVideo=!!i,this.azWebRTC.bindVideo(s,a),this.azWebRTC.start(!0,e,t)},azstack.azAcceptVideoCall=function(e,t,s,a,i){this.azWebRTC.currentPeerConnection||this.azWebRTC.init(),this.azWebRTC.hasVideo=!!i,this.azWebRTC.bindVideo(s,a),this.azWebRTC.start(!1,e,t)},azstack.azRejectVideoCall=function(e,t){var s={to:e,callId:t,status:603};azstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,s),azstack.log("DEBUG","Reject the video call: "+JSON.stringify(s)),this.azWebRTC.clean()},azstack.azStopVideoCall=function(e,t){var s={to:e,callId:t,status:700};azstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,s),azstack.log("DEBUG","Stop the video call: "+JSON.stringify(s)),this.azWebRTC.clean()},azstack.azNotAnsweredVideoCall=function(e,t){
var s={to:e,callId:t,status:400};azstack.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,s),azstack.log("DEBUG","Emit the not answered video call: "+JSON.stringify(s)),this.azWebRTC.clean()},azstack.updateUserInfoWithCallBack=function(e,t){this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,t,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,t),this.sendPacket(SERVICE_TYPE_USER_INFO,{userId:e,purpose:this.callbackId})},azstack.updateUserInfoByUsernameWithCallBack=function(e,t){this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,t,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,t),this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:[e],purpose:this.callbackId})},azstack.azGetBroadcastInfo=function(e,t){var s={id:e};this.sendPacket(SERVICE_TYPE_CHAT_BROADCAST_INFO,s),this.addTimeout("getBroadcastInfo_"+e,t,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("getBroadcastInfo_"+e,t)},azstack.azLeaveGroupAndChangeAdmin=function(e,t,s,a,i){var o={leaveUser:e,group:s,msgId:a,newAdmin:t};this.sendPacket(SERVICE_TYPE_LEAVE_CHAT_GROUP,o),this.addTimeout("leaveGroup_"+a,i,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("leaveGroup_"+a,i)},azstack.azChargingGetBalance=function(e){this.callbackId++;var t={tmpId:this.callbackId};this.sendPacket(SERVICE_TYPE_CHARGING_GET_BALANCE,t),this.addTimeout("chargingGetBalance_"+this.callbackId,e,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("chargingGetBalance_"+this.callbackId,e)},azstack.getUserInfoByListUsernameAndRequestToServerWithCallBack=function(e,t,s){this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,t,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,t);for(var a=[],i=0;i<e.length;i++){var o=e[i],c=this.azStackUsers.get(o);c&&a.push(c)}return a.length!=e.length?this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:e,purpose:this.callbackId}):(this.clearTimeout("get_user_server_"+this.callbackId),this.callCallback("get_user_server_"+this.callbackId,a)),a},azstack.getUserInfoByListUsernameAndRequestToServer=function(e,t){for(var s=[],a=0;a<e.length;a++){var i=e[a],o=this.azStackUsers.get(i);o&&s.push(o)}return s.length!=e.length&&this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:e}),s},azstack.updateUserInfoByListUsernameWithCallBack=function(e,t){this.callbackId++,this.addTimeout("get_user_server_"+this.callbackId,t,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("get_user_server_"+this.callbackId,t),this.sendPacket(SERVICE_TYPE_LIST_USERINFO_BY_USERNAME,{usernameList:e,purpose:this.callbackId})},azstack.cancelMessage=function(e,t,s){var a={id:e,to:t,chatId:t,type:1};this.sendPacket(SERVICE_TYPE_CANCEL_MESSAGE,a),this.addTimeout("cancelMessage_"+t+"_"+e,s,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("cancelMessage_"+t+"_"+e,s)},azstack.groupCancelMessage=function(e,t,s){var a={msgId:e,group:t,chatId:t,type:2};this.sendPacket(SERVICE_TYPE_CHAT_GROUP_CANCEL_MESSAGE,a),this.addTimeout("groupCancelMessage_"+t+"_"+e,s,{r:-1},azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected?azstack.callbackTimeoutTime:0),this.addCallback("groupCancelMessage_"+t+"_"+e,s)},azstack.ping_processor=function(e,t){this.sendPacket(SERVICE_TYPE_PING,{})},azstack.get_server_addr_processor=function(e,t){azstack.log("DEBUG","get_server_addr_processor"),azstack.log("DEBUG",t),this.slaveServerIp=t.ip,this.slaveServerPort=t.port,azstack.log("DEBUG","this.slaveServerIp: "+this.slaveServerIp),azstack.log("DEBUG","this.slaveServerPort: "+this.slaveServerPort),this.masterSocket.disconnect(),this.slaveSocket=io.connect(this.chatProxyServer,{resource:"B/socket.io","force new connection":!0}),this.slaveSocket.io.reconnection(!1),this.slaveSocket.on("connect",function(){azstack.log("INFO","Client has connected to the SlaveServer!"),azstack.internalAuthentication()}),this.slaveSocket.on("WebPacket",function(e){var t;t=e.body.length>0?JSON.parse(e.body):{},azstack.packetReceived(e.service,t)}),this.slaveSocket.on("disconnect",function(){azstack.log("INFO","The client has disconnected with SlaveServer!");var e=function(){if(!azstack.reConnecting&&azstack.appId&&azstack.publicKey&&azstack.azStackUserId){azstack.reConnecting=!0,azstack.connect(azstack.appId,azstack.publicKey,azstack.azStackUserId,azstack.userCredentials,azstack.fullname);var t=setInterval(function(){clearInterval(t),setTimeout(function(){azstack.reConnecting=!1,azstack&&azstack.slaveSocket&&azstack.slaveSocket.connected||e()},azstack.slaveSocket.io.timeout())},500)}};e()})},azstack.internalAuthentication=function(){var e={sdkVersion:this.sdkVersion,azStackUserID:this.azStackUserId,userCredentials:this.userCredentials},t=new JSEncrypt;t.setPublicKey(this.publicKey);var s=t.encrypt(JSON.stringify(e));if(!s)return void console.log("Could not encrypt authenStringPlaintext, please check your public key");azstack.log("DEBUG","send authen packet to SlaveServer");var a={slaveIp:this.slaveServerIp,slavePort:this.slaveServerPort,token:s,fullname:this.fullname,namespace:this.namespace,appId:this.appId,platform:3,sdkVersion:this.sdkVersion,screenSize:window.screen.width+"x"+window.screen.height},i=this.getCookie("sessionToken"),o=this.getCookie("sessionId");""!=i&&(a.sessionToken=i),""!=o&&(a.sessionId=o),this.sendPacket(SERVICE_TYPE_AUTHENTICATION_2_STEP,a)},azstack.authentication_processor=function(e,t){if(1==t.resultCode){this.azWebRTC.iceServers=[];for(var s=0;s<t.ice_server.length;s++)this.azWebRTC.iceServers.push({url:t.ice_server[s].url?t.ice_server[s].url:"",username:t.ice_server[s].username?t.ice_server[s].username:"",credential:t.ice_server[s].password?t.ice_server[s].password:""})}t.sessionToken&&""==this.getCookie("sessionToken")&&this.setCookie("sessionToken",t.sessionToken,365),t.sessionId&&""==this.getCookie("sessionId")&&this.setCookie("sessionId",t.sessionId,365);var a={fullname:t.fullname,azStackUserId:t.username,userId:t.userId,namespace:this.namespace};this.onAuthenticationCompleted(t.resultCode,a,t.resultMsg)},azstack.messageProcessor=function(e,t){var s=this.getUserInfoAndRequestToServer(t.from,{service:e,body:t});return s?(t.from=s,t.type=1,this.onMessagesSent(t),this.clearTimeout("send_message_"+t.msgId),void this.callCallback("send_message_"+t.msgId,t)):void azstack.log("DEBUG","messageProcessor chua co info, gui yeu cau len server lay info")},azstack.messageReportProcessor=function(e,t){var s={msgIds:[t.msgId],from:t.from,type:1,chatId:t.from,modified:t.time};this.deliveredMessagesProcessor(e,s)},azstack.messageGroupProcessor=function(e,t){var s=t.group,a=this.groups.get(s);if(!a){var i=new HashMap;return i.put(s,1),void this.requestGroupInfoForPacket(i,e,t)}t.group=a,t.type=2,this.onMessagesSent(t),this.clearTimeout("send_message_group_"+t.msgId),this.callCallback("send_message_group_"+t.msgId,t)},azstack.messageReportGroupProcessor=function(e,t){var s={msgIds:[t.msgId],from:t.from,type:2,chatId:t.group,modified:t.modified};this.deliveredMessagesProcessor(e,s)},azstack.deliveredMessagesProcessor=function(e,t){if(e=SERVICE_TYPE_DELIVERED_MESSAGES,delete t.senderId,!this.users.get(t.from)){var s=new HashMap;return s.put(t.from,1),void this.requestUserInfoForPacket(s,e,t)}if(t.from=this.users.get(t.from),1==t.type)delete t.chatId;else if(2==t.type){var a=t.chatId,i=this.groups.get(a);if(!i){var o=new HashMap;return o.put(a,1),void this.requestGroupInfoForPacket(o,e,t)}t.group=i}this.onMessagesDelivered(t)},azstack.have_message_processor=function(e,t){var s=this.getUserInfoAndRequestToServer(t.from,{service:e,body:t});if(s){var a={msgId:t.msgId,msg:t.msg,type:0,time:t.time};this.users.get(s.userId)&&(this.users.get(s.userId).status=1),this.azStackUsers.get(s.azStackUserID)&&(this.azStackUsers.get(s.azStackUserID).status=1),this.onMessageReceived(s,a)}},azstack.haveMessageStickerProcessor=function(e,t){var s=this.getUserInfoAndRequestToServer(t.from,{service:e,body:t});if(s){var a={width:t.width,height:t.height,url:t.url,catId:t.catId,imgName:t.imgName,msgId:t.id,msg:t.msg,type:3,time:t.created};this.users.get(s.userId)&&(this.users.get(s.userId).status=1),this.azStackUsers.get(s.azStackUserID)&&(this.azStackUsers.get(s.azStackUserID).status=1),this.onMessageReceived(s,a)}},azstack.have_message_file_url_processor=function(e,t){var s=this.getUserInfoAndRequestToServer(t.from,{service:e,body:t});if(s){var a={width:t.width,height:t.height,msgId:t.id,msg:t.msg,type:t.type,url:t.url,time:t.created,fileName:t.fileName,fileLength:t.fileLength,duration:t.duration};this.users.get(s.userId)&&(this.users.get(s.userId).status=1),this.azStackUsers.get(s.azStackUserID)&&(this.azStackUsers.get(s.azStackUserID).status=1),this.onMessageReceived(s,a)}},azstack.have_message_location_processor=function(e,t){var s=this.getUserInfoAndRequestToServer(t.from,{service:e,body:t});s&&(this.users.get(s.userId)&&(this.users.get(s.userId).status=1),this.azStackUsers.get(s.azStackUserID)&&(this.azStackUsers.get(s.azStackUserID).status=1),this.onMessageReceived(s,t))},azstack.haveMessageGroupProcessor=function(e,t){if(!this.users.get(t.from)){var s=new HashMap;return s.put(t.from,1),void this.requestUserInfoForPacket(s,e,t)}t.from=this.users.get(t.from);var a=this.groups.get(t.group);if(!a){var i=new HashMap;return i.put(t.group,1),void this.requestGroupInfoForPacket(i,e,t)}t.group=a,this.users.get(t.from.userId)&&(this.users.get(t.from.userId).status=1),this.azStackUsers.get(t.from.azStackUserID)&&(this.azStackUsers.get(t.from.azStackUserID).status=1),this.onGroupMessageReceived(t)},azstack.chat_typing_processor=function(e,t){this.users.get(t.from)&&(this.users.get(t.from).status=1,this.azStackUsers.get(this.users.get(t.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(t.from).azStackUserID).status=1)),azstack.log("INFO","chat typing from: "+t.from)},azstack.chat_group_typing_processor=function(e,t){this.users.get(t.from)&&(this.users.get(t.from).status=1,this.azStackUsers.get(this.users.get(t.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(t.from).azStackUserID).status=1)),azstack.log("INFO","chat group typing from: "+t.from+", to group: "+t.group)},azstack.user_info_processor=function(e,t){azstack.log("DEBUG","user_info_processor, azStackUserID: "+t.username+", userId: "+t.userId),t.username||this.onListModifiedConversationDeleted({list:[{type:1,chatId:t.userId,deleted:1}],done:1}),this.clearTimeout("get_user_server_"+t.purpose),this.callCallback("get_user_server_"+t.purpose,[t]),this.cacheUserInfo(t);var s=this.packet_queue.get(t.userId);if(s)for(;s.length>0;){var a=s.pop();void 0!=a&&this.packetReceived(a.service,a.body)}},azstack.user_info_by_username_processor=function(e,t){var s=t.userInfoList;for(this.clearTimeout("get_user_server_"+t.purpose),this.callCallback("get_user_server_"+t.purpose,t.userInfoList);s.length>0;){var a=s.pop();azstack.log("DEBUG","user_info_by_username from server, azStackUserID: "+a.username+", userId: "+a.userId),a.username||this.onListModifiedConversationDeleted({list:[{type:1,chatId:a.userId,deleted:1}],done:1}),this.cacheUserInfo(a);var i=this.send_packet_queue.get(a.username);if(i)for(;i.length>0;){var o=i.pop();if(void 0!=o&&(o.service==SERVICE_TYPE_MESSAGE2||o.service==SERVICE_TYPE_MESSAGE_FILE_URL||o.service==SERVICE_TYPE_MESSAGE_STICKER)){if(!a.userId){azstack.log("DEBUG","khong gui dc tin nhan vi user nay chua ton tai");continue}o.body.to=a.userId,this.sendPacket(o.service,o.body),azstack.log("DEBUG","Gui bu packet dang cho` trong queue"),azstack.log("DEBUG",o)}}}},azstack.getListUserInfoByListUserIDsProcessor=function(e,t){for(;t.userInfoList.length>0;){var s=t.userInfoList.pop();this.cacheUserInfo(s)}var a=this.waitingPacketByListUserId.get(t.purpose);a&&(this.waitingPacketByListUserId.remove(t.purpose),this.packetReceived(a.service,a.body))},azstack.getListGroupInfoProcessor=function(e,t){for(;t.listGroups.length>0;){var s=t.listGroups.pop();this.groups.put(s.id,s)}var a=this.waitingPacketByListUserId.get(t.purpose);a&&(this.waitingPacketByListUserId.remove(t.purpose),this.packetReceived(a.service,a.body))},azstack.getListGroupInfoMoreProcessor=function(e,t){this.addMemberGroupInfo(t)},azstack.get_list_modified_conversations_processor=function(e,t){for(var s=new HashMap,a=new HashMap,i=0;i<t.list.length;i++){var o=t.list[i];if(delete o.ownerId,void 0!=o.lastMsg&&(o.lastMsg.sender instanceof Object&&(o.lastMsg.sender=o.lastMsg.sender.userId),this.users.get(o.lastMsg.sender)?o.lastMsg.sender=this.users.get(o.lastMsg.sender):s.put(o.lastMsg.sender,1)),1==o.type)this.users.get(o.chatId)?o.chatTarget=this.users.get(o.chatId):s.put(o.chatId,1);else if(2==o.type){var c=this.groups.get(o.chatId);c?o.chatTarget=c:a.put(o.chatId,1)}}return a.size()>0?void this.requestGroupInfoForPacket(a,e,t):s.size()>0?void this.requestUserInfoForPacket(s,e,t):(this.onListModifiedConversationReceived(t),void(t.requestId&&(this.clearTimeout("getListModifiedConversationsPage_"+t.requestId),this.callCallback("getListModifiedConversationsPage_"+t.requestId,t))))},azstack.get_list_modified_messages_processor=function(e,t){for(var s=new HashMap,a=0;a<t.list.length;a++){var i=t.list[a];this.users.get(i.receiverId)?i.receiver=this.users.get(i.receiverId):s.put(i.receiverId,1),this.users.get(i.senderId)?i.sender=this.users.get(i.senderId):s.put(i.senderId,1)}return s.size()>0?void this.requestUserInfoForPacket(s,e,t):(this.onListModifiedMessagesReceived(t),void(t.requestId&&(this.clearTimeout("getListModifiedMessagesPage_"+t.requestId),this.callCallback("getListModifiedMessagesPage_"+t.requestId,t))))},azstack.get_list_unread_messages_processor=function(e,t){for(var s=new HashMap,a=0;a<t.list.length;a++){var i=t.list[a];this.users.get(i.receiverId)?i.receiver=this.users.get(i.receiverId):s.put(i.receiverId,1),this.users.get(i.senderId)?i.sender=this.users.get(i.senderId):s.put(i.senderId,1)}return s.size()>0?void this.requestUserInfoForPacket(s,e,t):(this.onListUnreadMessagesReceived(t),void(t.requestId&&(this.clearTimeout("getListUnreadMessagesPage_"+t.requestId),this.callCallback("getListUnreadMessagesPage_"+t.requestId,t))))},azstack.haveMsgFromMeProcessor=function(e,t){if(!this.users.get(t.to)){var s=new HashMap;return s.put(t.to,1),void this.requestUserInfoForPacket(s,e,t)}t.to=this.users.get(t.to),t.chatType=1,this.onMessageFromMe(t)},azstack.haveMsgGroupFromMeProcessor=function(e,t){var s=this.groups.get(t.group);if(!s){var a=new HashMap;return a.put(t.group,1),void this.requestGroupInfoForPacket(a,e,t)}t.group=s,t.chatType=2,delete t.from,this.onMessageFromMe(t)},azstack.makeGroupProcessor=function(e,t){this.clearTimeout("makeGroup_"+t.msgId),this.callCallback("makeGroup_"+t.msgId,t)},azstack.inviteToGroupProcessor=function(e,t){this.clearTimeout("inviteToGroup_"+t.msgId),this.callCallback("inviteToGroup_"+t.msgId,t)},azstack.leaveGroupProcessor=function(e,t){this.clearTimeout("leaveGroup_"+t.msgId),this.callCallback("leaveGroup_"+t.msgId,t)},azstack.renameGroupProcessor=function(e,t){this.clearTimeout("renameGroup_"+t.msgId),this.callCallback("renameGroup_"+t.msgId,t)},azstack.applicationChangeStateProcessor=function(e,t){this.onApplicationChangeState(t)},azstack.getGroupInfoProcessor=function(e,t){0==t.r?this.cacheGroupInfo(t):this.onListModifiedConversationDeleted({list:[{type:2,chatId:t.group,deleted:1}],done:1}),this.clearTimeout("getGroupInfo_"+t.group),this.callCallback("getGroupInfo_"+t.group,t)},azstack.getBroadcastInfoProcessor=function(e,t){0!=t.r&&this.onListModifiedConversationDeleted({list:[{type:2,chatId:t.id,deleted:1}],done:1}),this.clearTimeout("getBroadcastInfo_"+t.id),this.callCallback("getBroadcastInfo_"+t.id,t)},azstack.makeGroupNotificationProcessor=function(e,t){this.users.get(t.admin)&&(this.users.get(t.admin).status=1,this.azStackUsers.get(this.users.get(t.admin).azStackUserID)&&(this.azStackUsers.get(this.users.get(t.admin).azStackUserID).status=1)),this.onMakeGroupNotification(t)},azstack.inviteToGroupNotificationProcessor=function(e,t){this.users.get(t.from)&&(this.users.get(t.from).status=1,this.azStackUsers.get(this.users.get(t.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(t.from).azStackUserID).status=1)),this.onInviteGroupNotification(t)},azstack.leaveGroupNotificationProcessor=function(e,t){this.users.get(t.from)&&(this.users.get(t.from).status=1,this.azStackUsers.get(this.users.get(t.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(t.from).azStackUserID).status=1)),this.groups.get(t.group)&&t.admin&&(this.groups.get(t.group).admin=t.admin),this.onLeaveGroupNotification(t)},azstack.renameGroupNotificationProcessor=function(e,t){this.users.get(t.from)&&(this.users.get(t.from).status=1,this.azStackUsers.get(this.users.get(t.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(t.from).azStackUserID).status=1)),this.groups.get(t.group)&&t.name&&(this.groups.get(t.group).name=t.name),this.onRenameGroupNotification(t)},azstack.deleteConversationProcessor=function(e,t){this.clearTimeout("deleteConversation_"+t.chatId+"_"+t.type+"_"+t.lastTimeCreated),this.callCallback("deleteConversation_"+t.chatId+"_"+t.type+"_"+t.lastTimeCreated,t),this.onDeleteConversation(t)},azstack.seenMessageProcessor=function(e,t){this.onSeenMessage(t)},azstack.seenMessagesProcessor=function(e,t){this.onSeenMessages(t)},azstack.deleteMessageProcessor=function(e,t){this.clearTimeout("deleteMessage_"+t.senderId+"_"+t.msgId),this.callCallback("deleteMessage_"+t.senderId+"_"+t.msgId,t)},azstack.listChatGroupProcessor=function(e,t){this.onListChatGroup(t)},azstack.chatGroupChangeAdminProcessor=function(e,t){this.users.get(t.from)&&(this.users.get(t.from).status=1,this.azStackUsers.get(this.users.get(t.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(t.from).azStackUserID).status=1)),this.groups.get(t.group)&&t.newAdmin&&(this.groups.get(t.group).admin=t.newAdmin),this.clearTimeout("chatGroupChangeAdmin_"+t.msgId),this.callCallback("chatGroupChangeAdmin_"+t.msgId,t),this.onChatGroupChangeAdmin(t)},azstack.chatListFilesProcessor=function(e,t){for(var s=new HashMap,a=0;a<t.list.length;a++){var i=t.list[a];this.users.get(i.receiverId)?i.receiver=this.users.get(i.receiverId):s.put(i.receiverId,1),this.users.get(i.senderId)?i.sender=this.users.get(i.senderId):s.put(i.senderId,1)}return s.size()>0?void this.requestUserInfoForPacket(s,e,t):void this.onListFilesReceived(t)},azstack.chatBroadCastCreateListProcessor=function(e,t){this.onBroadCastCreateList(t)},azstack.chatBroadCastEditListProcessor=function(e,t){this.onBroadCastEditList(t)},azstack.chatBroadCastGetListProcessor=function(e,t){this.onBroadCastGetList(t)},azstack.messageBroadCastProcessor=function(e,t){this.onMessageBroadCast(t),this.clearTimeout("send_message_broadcast_"+t.msgId),this.callCallback("send_message_broadcast_"+t.msgId,t)},azstack.haveMessageBroadCastProcessor=function(e,t){this.users.get(t.from)&&(this.users.get(t.from).status=1,this.azStackUsers.get(this.users.get(t.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(t.from).azStackUserID).status=1)),this.onHaveMessageBroadCast(t)},azstack.chatBroadCastDeleteListProcessor=function(e,t){this.onChatBroadCastDeleteList(t)},azstack.chatBroadCastGetMessagesProcessor=function(e,t){this.onChatBroadCastGetMessages(t)},azstack.chatGroupJoinPublicProcessor=function(e,t){this.onChatGroupJoinPublic(t)},azstack.chatGroupGetListPublicProcessor=function(e,t){this.onChatGroupGetListPublic(t)},azstack.inviteVideoCallProcessor=function(e,t){if(this.azWebRTC.currentCall){var s={to:t.from,callId:t.callId,status:600};this.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,s),azstack.log("DEBUG","response busy to other call when being on a call")}else{var s={to:t.from,callId:t.callId,status:180};this.sendPacket(SERVICE_TYPE_WEBRTC_CALL_STATUS_CHANGE,s),this.azWebRTC.currentCall=t.callId,this.azWebRTC.remoteSdp=t.sdp,t.hasVideo=2===t.mediaType,this.onInviteVideoCall(t)}},azstack.dataVideoCallProcessor=function(e,t){if(this.azWebRTC.currentCall)if(1==t.type){if(this.azWebRTC.remoteSdp=t.data,azstack.log("DEBUG","Video call received sdp: "+JSON.stringify(t)),this.azWebRTC.isCaller){if(!this.azWebRTC.currentPeerConnection)return void azstack.log("ERROR","currentPeerConnection is null");if(!RTCSessionDescription)return void azstack.log("ERROR","RTCSessionDescription is null");if(azstack.log("DEBUG","set remote sdp in event"),this.azWebRTC.currentPeerConnection.setRemoteDescription(new RTCSessionDescription(this.azWebRTC.remoteSdp)),this.azWebRTC.unAddedRemoteSdp=!1,this.azWebRTC.unAddedRemoteCandidate.length>0)if(this.azWebRTC.currentPeerConnection)if(RTCIceCandidate){azstack.log("DEBUG","set remote candidate after receive sdp");for(var s=0;s<this.azWebRTC.unAddedRemoteCandidate.length;s++)this.azWebRTC.currentPeerConnection.addIceCandidate(new RTCIceCandidate(this.azWebRTC.unAddedRemoteCandidate[s]));this.azWebRTC.unAddedRemoteCandidate=[]}else azstack.log("ERROR","RTCIceCandidate is null");else azstack.log("ERROR","currentPeerConnection is null")}}else if(2==t.type){var a={candidate:t.data.sdp,sdpMid:t.data.sdpMid,sdpMLineIndex:t.data.sdpMLineIndex};if(this.azWebRTC.remoteCandidate.push(a),azstack.log("DEBUG","Video call receive candidate: "+JSON.stringify(t)),this.azWebRTC.unAddedRemoteSdp)this.azWebRTC.unAddedRemoteCandidate.push(a);else{if(!this.azWebRTC.currentPeerConnection)return void azstack.log("ERROR","currentPeerConnection is null");if(!RTCIceCandidate)return void azstack.log("ERROR","RTCIceCandidate is null");azstack.log("DEBUG","set remote candidate in event"),this.azWebRTC.currentPeerConnection.addIceCandidate(new RTCIceCandidate(a))}}},azstack.statusVideoCallProcessor=function(e,t){if(this.azWebRTC.currentCall&&this.azWebRTC.currentCall!=t.callId)return void azstack.log("ignore other call's packet when being in a call");switch(t.status){case 100:this.azWebRTC.currentCall&&this.onVideoCallConnecting(t);break;case 180:this.azWebRTC.currentCall&&this.onVideoCallRinging(t);break;case 200:this.azWebRTC.currentCall&&this.onVideoCallAnswered(t);break;case 600:this.azWebRTC.currentCall&&(this.azWebRTC.clean(),this.onVideoCallBusy(t));break;case 603:this.azWebRTC.currentCall&&(this.azWebRTC.clean(),this.onVideoCallRejected(t));break;case 700:this.azWebRTC.currentCall&&(this.azWebRTC.clean(),this.onVideoCallStop(t));break;case 400:this.azWebRTC.clean(),this.onVideoCallNotAnswered(t);break;default:this.azWebRTC.clean(),this.onVideoCallError(t)}},azstack.statusVideoCallByMeProcessor=function(e,t){switch(t.status){case 200:this.azWebRTC.clean(),this.onVideoCallAnsweredByMe(t);break;case 600:this.azWebRTC.clean(),this.onVideoCallBusyByMe(t);break;case 603:this.azWebRTC.clean(),this.onVideoCallRejectedByMe(t);break;case 700:this.azWebRTC.clean(),this.onVideoCallStopByMe(t);break;case 400:this.azWebRTC.clean(),this.onVideoCallNotAnsweredByMe(t);break;default:this.azWebRTC.clean(),this.onVideoCallErrorByMe(t)}},azstack.chargingGetBalanceProcessor=function(e,t){0==t.r&&this.azStackUsers.get(this.azStackUserId)&&(this.azStackUsers.get(this.azStackUserId).balance=t.balance,this.users.get(this.azStackUsers.get(this.azStackUserId).userId)&&(this.users.get(this.azStackUsers.get(this.azStackUserId).userId).balance=t.balance)),this.clearTimeout("chargingGetBalance_"+t.tmpId),this.callCallback("chargingGetBalance_"+t.tmpId,t)},azstack.cancelMessageProcessor=function(e,t){this.users.get(t.from)&&(this.users.get(t.from).status=1,this.azStackUsers.get(this.users.get(t.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(t.from).azStackUserID).status=1)),this.onCancelMessage(t)},azstack.groupCancelMessageProcessor=function(e,t){this.users.get(t.from)&&(this.users.get(t.from).status=1,this.azStackUsers.get(this.users.get(t.from).azStackUserID)&&(this.azStackUsers.get(this.users.get(t.from).azStackUserID).status=1)),this.onGroupCancelMessage(t)},azstack.onAuthenticationCompleted=function(e,t){azstack.log("ERROR","please implement method: azAuthentication")},azstack.onMessageReceived=function(e,t){azstack.log("ERROR","please implement method: azHaveMessage")},azstack.onGroupMessageReceived=function(e){azstack.log("ERROR","please implement method: onGroupMessageReceived"),azstack.log("INFO","onGroupMessageReceived: "+e)},azstack.onListModifiedConversationReceived=function(e){azstack.log("ERROR","please implement method: azHaveMessage")},azstack.onListModifiedMessagesReceived=function(e){azstack.log("ERROR","please implement method: onListModifiedMessagesReceived")},azstack.onListUnreadMessagesReceived=function(e){azstack.log("ERROR","please implement method: onListUnreadMessagesReceived")},azstack.onMessagesDelivered=function(e){azstack.log("ERROR","please implement method: onMessagesDelivered")},azstack.onMessagesSent=function(e){azstack.log("ERROR","please implement method: onMessagesSent")},azstack.onMessageFromMe=function(e){azstack.log("ERROR","please implement method: onMessageFromMe")},azstack.onMakeGroupNotification=function(e){azstack.log("ERROR","please implement method: onMakeGroupNotification")},azstack.onInviteGroupNotification=function(e){azstack.log("ERROR","please implement method: onInviteGroupNotification")},azstack.onLeaveGroupNotification=function(e){azstack.log("ERROR","please implement method: onLeaveGroupNotification")},azstack.onRenameGroupNotification=function(e){azstack.log("ERROR","please implement method: onRenameGroupNotification")},azstack.onDeleteConversation=function(e){azstack.log("ERROR","please implement method: onDeleteConversation")},azstack.onSeenMessage=function(e){azstack.log("ERROR","please implement method: onSeenMessage")},azstack.onSeenMessages=function(e){azstack.log("ERROR","please implement method: onSeenMessages")},azstack.onDeleteMessage=function(e){azstack.log("INFO","please implement method: onDeleteMessage")},azstack.onListChatGroup=function(e){azstack.log("INFO","please implement method: onListChatGroup, packet: "+JSON.stringify(e))},azstack.onChatGroupChangeAdmin=function(e){azstack.log("INFO","please implement method: onChatGroupChangeAdmin, packet: "+JSON.stringify(e))},azstack.onListFilesReceived=function(e){azstack.log("INFO","please implement method: onListFiles, packet: "+JSON.stringify(e))},azstack.onApplicationChangeState=function(e){azstack.log("INFO","please implement method: onApplicationChangeState, packet: "+JSON.stringify(e))},azstack.onBroadCastCreateList=function(e){azstack.log("INFO","please implement method: onBroadCastCreateList, packet: "+JSON.stringify(e))},azstack.onBroadCastEditList=function(e){azstack.log("INFO","please implement method: onBroadCastEditList, packet: "+JSON.stringify(e))},azstack.onBroadCastGetList=function(e){azstack.log("INFO","please implement method: onBroadCastGetList, packet: "+JSON.stringify(e))},azstack.onMessageBroadCast=function(e){azstack.log("INFO","please implement method: onMessageBroadCast, packet: "+JSON.stringify(e))},azstack.onHaveMessageBroadCast=function(e){azstack.log("INFO","please implement method: onHaveMessageBroadCast, packet: "+JSON.stringify(e))},azstack.onChatBroadCastDeleteList=function(e){azstack.log("INFO","please implement method: onChatBroadCastDeleteList, packet: "+JSON.stringify(e))},azstack.onChatBroadCastGetMessages=function(e){azstack.log("INFO","please implement method: onChatBroadCastGetMessages, packet: "+JSON.stringify(e))},azstack.onChatGroupJoinPublic=function(e){azstack.log("INFO","please implement method: onChatGroupJoinPublic, packet: "+JSON.stringify(e))},azstack.onChatGroupGetListPublic=function(e){azstack.log("INFO","please implement method: onChatGroupGetListPublic, packet: "+JSON.stringify(e))},azstack.onInviteVideoCall=function(e){azstack.log("INFO","please implement method: onInviteVideoCall, packet: "+JSON.stringify(e))},azstack.onVideoCallConnecting=function(e){azstack.log("INFO","please implement method: onVideoCallConnecting, packet: "+JSON.stringify(e))},azstack.onVideoCallRinging=function(e){azstack.log("INFO","please implement method: onVideoCallRinging, packet: "+JSON.stringify(e))},azstack.onVideoCallAnswered=function(e){azstack.log("INFO","please implement method: onVideoCallAnswered, packet: "+JSON.stringify(e))},azstack.onVideoCallBusy=function(e){azstack.log("INFO","please implement method: onVideoCallBusy, packet: "+JSON.stringify(e))},azstack.onVideoCallRejected=function(e){azstack.log("INFO","please implement method: onVideoCallRejected, packet: "+JSON.stringify(e))},azstack.onVideoCallStop=function(e){azstack.log("INFO","please implement method: onVideoCallStop, packet: "+JSON.stringify(e))},azstack.onVideoCallNotAnswered=function(e){azstack.log("INFO","please implement method: onVideoCallNotAnswered, packet: "+JSON.stringify(e))},azstack.onVideoCallError=function(e){azstack.log("INFO","please implement method: onVideoCallError, packet: "+JSON.stringify(e))},azstack.onVideoCallLocalVideoLoaded=function(){azstack.log("INFO","please implement method: onVideoCallLocalVideoLoaded")},azstack.onVideoCallRemoteVideoLoaded=function(){azstack.log("INFO","please implement method: onVideoCallRemoteVideoLoaded")},azstack.onVideoCallBusyByMe=function(e){azstack.log("INFO","please implement method: onVideoCallBusyByMe, packet: "+JSON.stringify(e))},azstack.onVideoCallAnsweredByMe=function(e){azstack.log("INFO","please implement method: onVideoCallAnsweredByMe, packet: "+JSON.stringify(e))},azstack.onVideoCallRejectedByMe=function(e){azstack.log("INFO","please implement method: onVideoCallRejectedByMe, packet: "+JSON.stringify(e))},azstack.onVideoCallStopByMe=function(e){azstack.log("INFO","please implement method: onVideoCallStopByMe, packet: "+JSON.stringify(e))},azstack.onVideoCallNotAnsweredByMe=function(e){azstack.log("INFO","please implement method: onVideoCallNotAnsweredByMe, packet: "+JSON.stringify(e))},azstack.onVideoCallErrorByMe=function(e){azstack.log("INFO","please implement method: onVideoCallErrorByMe, packet: "+JSON.stringify(e))},azstack.onListModifiedConversationDeleted=function(e){azstack.log("INFO","please implement method: onListModifiedConversationDeleted, packet: "+JSON.stringify(e))};